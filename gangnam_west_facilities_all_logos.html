<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>서울시 농구장·축구장 정보 (구별)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      margin-bottom: 15px;
    }
    button {
      margin: 0 5px 10px 0;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #888;
      background-color: #fafafa;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background-color: #eee;
    }
    #buttons {
      margin-bottom: 20px;
    }
    #results {
      margin-top: 10px;
    }
    .facility {
      margin: 15px 0;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      background-color: #f9f9f9;
    }
    .facility .header {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    .type-badge {
      display: inline-block;
      font-size: 0.85em;
      padding: 2px 8px;
      margin-right: 10px;
      border-radius: 4px;
      color: white;
      font-weight: bold;
    }
    .badge-basketball {
      background-color: #4a90e2; /* 농구장: 파란 계열 */
    }
    .badge-soccer {
      background-color: #7ed321; /* 축구장: 초록 계열 */
    }
    .badge-swimming {
      background-color: #50e3c2; /* 수영장: 청록 계열 */
    }
    .facility .name {
      font-size: 1.1em;
      font-weight: bold;
    }
    .facility .info {
      margin-top: 4px;
      line-height: 1.4;
    }
    .facility .info span {
      display: block;
      margin: 2px 0;
    }
    .facility a {
      color: #3366cc;
      text-decoration: none;
    }
    .facility a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>서울시 농구장·축구장 정보 (구별)</h1>

  <!-- 버튼 영역 -->
  <div id="buttons">
    <button onclick="showFacilities('강동구')">강동구</button>
    <button onclick="showFacilities('양천구')">양천구</button>
    <button onclick="showFacilities('영등포구')">영등포구</button>
    <button onclick="showFacilities('구로구')">구로구</button>
    <button onclick="showFacilities('금천구')">금천구</button>
  </div>

  <!-- 결과 출력 영역 -->
  <div id="results"></div>

  <script>
    // 전역 변수: API가 로드되면 이곳에 모든 시설 데이터가 저장됨.
    let facilities = null;

    // 페이지 로드 후, 한 번만 API를 가져옴
    window.addEventListener("DOMContentLoaded", () => {
      const API_KEY = "7a4c614179776f7432396372726b47";

      // —— END 인덱스를 1000으로 늘려서 더 많은 데이터를 가져옴 ——  
      const BASE_URL = "https://openapi.seoul.go.kr/" +
                       API_KEY + "/xml/ListPublicReservationSport/1/1000/";

      const urls = [
        { type: "농구장", url: BASE_URL + "농구장" },
        { type: "축구장", url: BASE_URL + "축구장" }
        // (필요 시) { type: "수영장", url: BASE_URL + "수영장" }
      ];

      Promise.all(
        urls.map(entry =>
          fetch(entry.url)
            .then(res => {
              if (!res.ok) throw new Error("Fetch 실패: " + res.status);
              return res.text();
            })
            .then(str => new DOMParser().parseFromString(str, "text/xml"))
            .then(xml => {
              const rows = xml.querySelectorAll("row");
              return Array.from(rows).map(row => ({
                type:  entry.type,
                area:  row.querySelector("AREANM")?.textContent || "",
                name:  row.querySelector("SVCNM")?.textContent  || "",
                place: row.querySelector("PLACENM")?.textContent|| "",
                tel:   row.querySelector("TEL")?.textContent    || "없음",
                status: row.querySelector("SVCSTATNM")?.textContent || "",
                url:   row.querySelector("SVCURL")?.textContent  || ""
              }));
            })
        )
      )
      .then(results => {
        // results = [ [농구장 배열], [축구장 배열] ]
        facilities = results.flat();
        console.log("API 데이터 로드 완료 → 총 시설 개수:", facilities.length);
      })
      .catch(err => {
        console.error("데이터 로드 중 오류 발생:", err);
        facilities = []; // 빈 배열로 두면 “오류로 인해 데이터 없음” 메시지 표시
      });
    });

    // 버튼 클릭 시 해당 구 데이터만 필터해서 화면에 표시
    function showFacilities(areaName) {
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = `<h2>${areaName} 농구장·축구장 목록</h2>`;

      // (1) 아직 API 로딩 중인 상태 = facilities === null
      if (facilities === null) {
        resultsDiv.innerHTML += "<p>시설 정보를 불러오는 중입니다. 잠시만 기다려 주세요...</p>";
        return;
      }

      // (2) API 로드 완료 후에도 오류나 데이터가 없는 상태 = facilities.length === 0
      if (facilities.length === 0) {
        resultsDiv.innerHTML += "<p>오류로 인해 시설 정보를 불러올 수 없거나, 데이터가 없습니다.</p>";
        return;
      }

      // (3) 실제 선택된 구에 해당하는 데이터만 필터
      const list = facilities.filter(item => item.area === areaName);
      if (list.length === 0) {
        resultsDiv.innerHTML += "<p>해당 구에 등록된 농구장·축구장 정보가 없습니다.</p>";
        return;
      }

      // (4) 잘 필터된 데이터가 있으면, 화면에 하나씩 렌더링
      list.forEach(f => {
        let badgeClass = "";
        if (f.type === "농구장")    badgeClass = "badge-basketball";
        else if (f.type === "축구장") badgeClass = "badge-soccer";
        else if (f.type === "수영장") badgeClass = "badge-swimming";

        const div = document.createElement("div");
        div.className = "facility";
        div.innerHTML = `
          <div class="header">
            <span class="type-badge ${badgeClass}">${f.type}</span>
            <span class="name">${f.name}</span>
          </div>
          <div class="info">
            <span>장소: ${f.place}</span>
            <span>전화번호: ${f.tel}</span>
            <span>상태: <strong>${f.status}</strong></span>
            <span><a href="${f.url}" target="_blank">예약 링크</a></span>
          </div>
        `;
        resultsDiv.appendChild(div);
      });
    }
  </script>
</body>
</html>

